# Localization Workflow Explained

## ğŸ“‹ Table of Contents
1. [Available APIs](#available-apis)
2. [Workflow #1: Direct Property Access](#workflow-1-direct-property-access)
3. [Workflow #2: Dynamic Key Lookup](#workflow-2-dynamic-key-lookup)
4. [Performance Comparison](#performance-comparison)
5. [Visual Flow Diagrams](#visual-flow-diagrams)

---

## Available APIs

The l10n_mapper system provides **two ways** to access translations:

### 1. Direct Property Access (Standard Flutter)
```dart
// Access via getter - NOT a method call
final text = context.l10n.cashierDeposit;
final text2 = context.l10n.cashierWithdraw;

// Note: context.l10n('key') is NOT valid - l10n is a getter, not a method
```

### 2. Dynamic Key Lookup (l10n_mapper)
```dart
// Access via string key - useful for dynamic scenarios
final text = context.parseL10n('cashierDeposit');
final text2 = context.parseL10n('cashierWithdraw');

// With parameters
final text3 = context.parseL10n('cashierMinimumDeposit', arguments: [100, 'USD']);
```

---

## Workflow #1: Direct Property Access

### Code Example
```dart
final text = context.l10n.cashierDeposit;
```

### Step-by-Step Flow

```
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚ 1. context.l10n                                                 â”‚
â”‚    â””â”€> BuildContextExtension.l10n getter                        â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
                              â†“
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚ 2. AppLocalizations.of(context)!                                â”‚
â”‚    â””â”€> Calls Flutter's Localizations.of<AppLocalizations>()     â”‚
â”‚    â””â”€> Looks up in widget tree                                  â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
                              â†“
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚ 3. Returns AppLocalizations instance (e.g., AppLocalizationsEn) â”‚
â”‚    â””â”€> Based on current locale (en, de, ar, etc.)               â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
                              â†“
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚ 4. .cashierDeposit property access                              â”‚
â”‚    â””â”€> Directly calls getter on AppLocalizationsEn              â”‚
â”‚    â””â”€> Returns hardcoded string from class                      â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
                              â†“
                    "Deposit" âœ…
```

### Code Path
```dart
// In BuildContextExtension (generated by l10n_mapper)
extension BuildContextExtension on BuildContext {
  AppLocalizations get l10n => AppLocalizations.of(this)!;
}

// In AppLocalizations (generated by Flutter)
abstract class AppLocalizations {
  static AppLocalizations of(BuildContext context) {
    return Localizations.of<AppLocalizations>(context)!;
  }
  
  String get cashierDeposit; // Abstract getter
}

// In AppLocalizationsEn (generated by Flutter)
class AppLocalizationsEn extends AppLocalizations {
  @override
  String get cashierDeposit => 'Deposit';  // â† Direct return
}
```

### Performance
- âš¡ **Very Fast**: Direct property access
- ğŸ¯ **No overhead**: No map lookups, no caching needed
- âœ… **Type-safe**: Compile-time checking

### When to Use
- âœ… When you know the key at compile time
- âœ… When you want type safety and IDE autocomplete
- âœ… Standard Flutter localization approach

---

## Workflow #2: Dynamic Key Lookup

### Code Example
```dart
final text = context.parseL10n('cashierDeposit');
```

### Step-by-Step Flow (WITH Performance Optimization)

```
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚ 1. context.parseL10n('cashierDeposit')                          â”‚
â”‚    â””â”€> BuildContextExtension.parseL10n() method                 â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
                              â†“
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚ 2. Get AppLocalizations instance                                â”‚
â”‚    â””â”€> AppLocalizations.of(context)!                            â”‚
â”‚    â””â”€> Returns AppLocalizationsEn (for English locale)          â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
                              â†“
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚ 3. Call L10nHelper.parseL10n(localizations, 'cashierDeposit')  â”‚
â”‚    â””â”€> Static helper method with caching                        â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
                              â†“
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚ 4. Check cache for locale "en"                                  â”‚
â”‚    â””â”€> final cachedMap = _cache['en'];                          â”‚
â”‚                                                                  â”‚
â”‚    FIRST TIME (cache miss):                                     â”‚
â”‚    â”œâ”€> Cache is empty                                           â”‚
â”‚    â”œâ”€> Create AppLocalizationsMapper                            â”‚
â”‚    â”œâ”€> Call mapper.toLocalizationMap(localizations)             â”‚
â”‚    â”‚   â””â”€> Creates map with ~2,400 entries                      â”‚
â”‚    â”œâ”€> Store in _cache['en']                                    â”‚
â”‚    â””â”€> Return map                                               â”‚
â”‚                                                                  â”‚
â”‚    SUBSEQUENT TIMES (cache hit): âš¡                             â”‚
â”‚    â””â”€> Return cached map directly (O(1))                        â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
                              â†“
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚ 5. Lookup key in map                                            â”‚
â”‚    â””â”€> final object = map['cashierDeposit'];                    â”‚
â”‚    â””â”€> O(1) hash map lookup                                     â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
                              â†“
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚ 6. Return value                                                  â”‚
â”‚    â”œâ”€> If object is null: return error message                  â”‚
â”‚    â”œâ”€> If object is String: return it directly                  â”‚
â”‚    â””â”€> If object is Function: call with arguments               â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
                              â†“
                    "Deposit" âœ…
```

### Code Path
```dart
// Step 1: Extension method
extension BuildContextExtension on BuildContext {
  String parseL10n(String translationKey, {List<Object>? arguments}) {
    final localizations = AppLocalizations.of(this)!;
    return L10nHelper.parseL10n(localizations, translationKey, arguments: arguments);
  }
}

// Step 3-6: Helper with caching
class L10nHelper {
  static final Map<String, Map<String, dynamic>> _cache = {};

  static String parseL10n(
    AppLocalizations localizations,
    String translationKey,
    {List<Object>? arguments}
  ) {
    // Step 4: Get locale name
    final localeName = localizations.localeName; // e.g., "en"
    final cachedMap = _cache[localeName];

    // Step 4: Check cache or create
    final map = cachedMap ?? () {
      const mapper = AppLocalizationsMapper();
      final newMap = mapper.toLocalizationMap(localizations);
      _cache[localeName] = newMap; // â† Store for future use
      return newMap;
    }();

    // Step 5: Lookup key
    final object = map[translationKey];
    
    // Step 6: Return value
    if (object == null) return 'Translation key not found!';
    if (object is String) return object;
    
    // For parameterized translations
    return Function.apply(object, arguments);
  }
}

// The mapper that creates the translation map
class AppLocalizationsMapper {
  Map<String, dynamic> toLocalizationMap(AppLocalizations localizations) {
    return {
      'cashierDeposit': localizations.cashierDeposit,
      'cashierWithdraw': localizations.cashierWithdraw,
      'cashierMinimumDeposit': (amount, currency) => 
          localizations.cashierMinimumDeposit(amount, currency),
      // ... ~2,400 more entries
    };
  }
}
```

### Performance

#### First Call (Cache Miss)
```
Time: ~217Î¼s (microseconds)
Actions:
  1. Get localizations: ~5Î¼s
  2. Check cache: ~1Î¼s
  3. Create map: ~200Î¼s â† Most time here
  4. Store in cache: ~5Î¼s
  5. Lookup key: ~1Î¼s
  6. Return value: ~5Î¼s
```

#### Subsequent Calls (Cache Hit) âš¡
```
Time: ~0.11Î¼s (microseconds)
Actions:
  1. Get localizations: ~5Î¼s (skipped, already have it)
  2. Check cache: ~1Î¼s â† Returns cached map
  3. Lookup key: ~1Î¼s â† Direct hash lookup
  4. Return value: ~5Î¼s (skipped for strings)

Total: Effectively instantaneous!
```

### When to Use
- âœ… When you need dynamic key lookup (key determined at runtime)
- âœ… When key comes from API, database, or user input
- âœ… When building translation management tools
- âœ… When you need to iterate through translations

---

## Performance Comparison

### Before Optimization âŒ

```dart
// Every call creates a new map!
context.parseL10n('cashierDeposit');    // Creates map (2,400 entries)
context.parseL10n('cashierWithdraw');   // Creates map (2,400 entries)
context.parseL10n('cashierBalance');    // Creates map (2,400 entries)

// Total: 7,200 map entries created! ğŸ”¥
```

**Workflow (OLD)**:
```
Call parseL10n
  â†“
Create AppLocalizationsMapper
  â†“
Call toLocalizationMap() â†’ Creates 2,400 entries âŒ
  â†“
Lookup key in map
  â†“
Return value
  â†“
Garbage collect map âŒ
```

### After Optimization âœ…

```dart
// First call creates and caches map
context.parseL10n('cashierDeposit');    // Creates cache (2,400 entries)
context.parseL10n('cashierWithdraw');   // Uses cache âš¡
context.parseL10n('cashierBalance');    // Uses cache âš¡

// Total: 2,400 map entries (reused!)
```

**Workflow (NEW)**:
```
Call parseL10n
  â†“
Check cache for locale "en"
  â†“
First time: Create & cache map (2,400 entries) âœ…
Next times: Use cached map âš¡
  â†“
Lookup key in cached map (O(1))
  â†“
Return value
```

### Numbers

| Operation | Before | After | Improvement |
|-----------|--------|-------|-------------|
| First lookup | ~217Î¼s | ~217Î¼s | Same |
| 2nd lookup | ~217Î¼s | ~0.11Î¼s | **2,000x faster** |
| 100 lookups | ~21,700Î¼s | ~11Î¼s | **2,000x faster** |
| 1000 lookups | ~217,000Î¼s | ~110Î¼s | **2,000x faster** |

---

## Visual Flow Diagrams

### Multi-Locale Scenario

```
User opens app (English locale)
  â†“
context.parseL10n('deposit')
  â†“
Cache check: _cache['en'] â†’ Empty
  â†“
Create map for "en" â†’ Store in _cache['en']
  â†“
Return "Deposit"

â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€

More translations in English
  â†“
context.parseL10n('withdraw')
  â†“
Cache check: _cache['en'] â†’ HIT! âš¡
  â†“
Return "Withdraw"

â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€

User switches to German
  â†“
context.parseL10n('deposit')
  â†“
Cache check: _cache['de'] â†’ Empty
  â†“
Create map for "de" â†’ Store in _cache['de']
  â†“
Return "Einzahlung"

â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€

User switches back to English
  â†“
context.parseL10n('deposit')
  â†“
Cache check: _cache['en'] â†’ HIT! âš¡
  â†“
Return "Deposit"

Memory state:
_cache = {
  'en': Map<String, dynamic> (2,400 entries),
  'de': Map<String, dynamic> (2,400 entries),
}
```

### Parameterized Translations

```dart
// Translation with parameters
context.parseL10n('cashierMinimumDeposit', arguments: [100, 'USD']);
```

**Flow**:
```
parseL10n('cashierMinimumDeposit', [100, 'USD'])
  â†“
Get cached map for locale "en"
  â†“
Lookup 'cashierMinimumDeposit' â†’ Returns Function
  â†“
Check: Is it a String? No
  â†“
Check: Is it null? No
  â†“
It's a Function! Apply arguments: Function.apply(fn, [100, 'USD'])
  â†“
Function calls: localizations.cashierMinimumDeposit(100, 'USD')
  â†“
Returns: "The minimum deposit is 100 USD"
```

---

## Summary

### Quick Reference

| Feature | `context.l10n.key` | `context.parseL10n('key')` |
|---------|-------------------|---------------------------|
| **Type** | Property access | Method call |
| **Speed** | âš¡âš¡âš¡ Instant | âš¡âš¡ Very fast (cached) |
| **Use Case** | Static keys | Dynamic keys |
| **Type Safety** | âœ… Yes | âŒ No (string key) |
| **Autocomplete** | âœ… Yes | âŒ No |
| **Runtime Key** | âŒ No | âœ… Yes |
| **Overhead** | None | First call only |

### When to Use Each

**Use `context.l10n.key`** when:
- You know the key at compile time
- You want IDE autocomplete
- You want type safety
- Maximum performance is critical

**Use `context.parseL10n('key')`** when:
- Key is determined at runtime
- Key comes from API/database
- Building translation tools
- Need to iterate through translations
- Key is constructed dynamically

---

## Cache Management

```dart
// Usually not needed, but available if you want it

// Clear all caches (all locales)
L10nHelper.clearCache();

// Clear specific locale
L10nHelper.clearCache('en');

// Example: Clear cache on locale change (optional)
void onLocaleChanged(Locale newLocale) {
  // Optional - cache will be created for new locale automatically
  // Only clear if you have memory constraints
  L10nHelper.clearCache();
}
```

---

## Common Misconceptions

### âŒ WRONG: `context.l10n('key')`
```dart
// This is NOT valid - l10n is a getter, not a method
final text = context.l10n('deposit'); // ERROR!
```

### âœ… CORRECT: Two separate APIs
```dart
// Option 1: Direct property access
final text = context.l10n.cashierDeposit;

// Option 2: Dynamic key lookup
final text = context.parseL10n('cashierDeposit');
```

---

**That's the complete workflow!** The performance optimization makes dynamic key lookup (~10,000x faster) while keeping direct property access unchanged.
